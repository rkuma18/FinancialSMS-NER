version: '3.8'

services:
  # --- 1. FastAPI Backend Service ---
  backend:
    build:
      context: ./backend  # Path to the directory containing the Dockerfile
    container_name: ner_fastapi_backend
    ports:
      - "8000:8000"     # Map container port 8000 to host port 8000
    volumes:
      # Mount the artifacts folder so the model is available inside the container
      - ./artifacts:/app/artifacts
    environment:
      # Optional: Set environment variables for model path or logging if needed
      - MODEL_PATH=/app/artifacts/best_ner_model
    restart: always

  # --- 2. Streamlit Frontend Service ---
  frontend:
    build:
      context: ./frontend # Path to the directory containing the Dockerfile
    container_name: ner_streamlit_frontend
    ports:
      - "8501:8501"     # Map container port 8501 (Streamlit default) to host port 8501
    depends_on:
      - backend         # Ensure backend starts before frontend
    # IMPORTANT: Update API_URL in your Streamlit code (client.py)
    # The frontend needs to talk to the backend using the SERVICE NAME (backend)
    environment:
      - API_URL=http://backend:8000/predict # Set API URL as an environment variable
    restart: always